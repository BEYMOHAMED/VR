<html>
  <head>
    <!-- aframe itself -->
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <!-- physics and other extras -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <script src="./dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <audio src="./audio/fire.mp3" id="fire"></audio>
    <audio src="./audio/explode.mp3" id="explode"></audio>
    <a-scene
      environment="preset:corneria"
      stats 
      physics="debug:true"
      sound="src: url(./audio/corneria.mp3); loop:true; autoplay:false; volume:1;"
    >

      <a-assets>
        <a-asset-item 
          id="spaceship" 
          src="models/spaceship/scene.gltf"
        >
        </a-asset-item>
      </a-assets>

      <a-assets>
        <a-asset-item 
          id="enemy" 
          src="models/enemy/scene.gltf"
        >
        </a-asset-item>
      </a-assets>

      <a-entity 
        camera="userHeight: 4"
        wasd-controls
        look-controls
        restrict-position
      >
        <a-text id="scoreboard" position="4 4 -5" value="Score: 0" text="color: orange; align: center; width: 7;font: https://cdn.aframe.io/fonts/mozillavr.fnt;"></a-text>
        <a-text id="health" position="0 4 -5" value="Health: 100" text="color: white; align: center; width: 7;font: https://cdn.aframe.io/fonts/mozillavr.fnt;"></a-text>
        <a-cursor></a-cursor>

        <a-entity 
          id='spaceship-model' 
          gltf-model="#spaceship"
          sound="src: url(./audio/fire.mp3); autoplay: false; loop: false; volume:0.5;"
          position="0 -4 1" 
          rotation="0 180 0"
          static-body
        >
        </a-entity>

      </a-entity>

      <a-entity 
        id='cube'
        material="shader: flat; color:red;"
        geometry="primitive:box; radius: 0.5;"
        position="0 1 -10"
        dynamic-body
      >
      </a-entity>

      <a-entity 
        id='sphere'
        material="color:green;"
        geometry="primitive:sphere; radius: 0.5;"
        position="10 1 -10"
        dynamic-body
      >
      </a-entity>

      <a-entity 
        id='enemy-model' 
        gltf-model="#spaceship"
        scale="0.5 0.5 0.5"
        position="0 3 -30" 
        dynamic-body="shape:box; sphereRadius: 0.3;"
        >
      </a-entity>

      <!-- background sky -->
      <a-sky material="shader: flat; color:#109BE4"></a-sky>

      <a-plane 
        material="shader: flat; color:#368D6B;" 
        rotation="-90 0 0" 
        width="1000" 
        height="1000" 
        static-body
      >
      </a-plane>
    </a-scene>
  </body>
  <script>
      let gamestate = {
        score: 0,
        health: 100,
        currentEnemyId: 0
      };

    var sceneEl = document.querySelector('a-scene');
    var cubeEl = document.querySelector('#cube');
    var arwingEl = document.querySelector('#enemy-model');
    var scoreEl = document.getElementById('scoreboard');
    var shipEl = document.getElementById('spaceship-model');

    function randomPosition() {
      return {
        x: Math.random() * 20,
        y: 1.5,
        z: Math.random() * 20
      };
    };

    cubeEl.addEventListener('click', (e) => {
      cubeEl.body.velocity.set(Math.random()*10, Math.random()*10,Math.random()*(-1));
      document.getElementById('explode').play();
      gamestate.score = gamestate.score + 1;
      scoreEl.setAttribute('value', 'Score: ' + gamestate.score);
      cubeEl.setAttribute('material','shader: flat; color:blue');
      setTimeout(() => {
        cubeEl.body.position.set(Math.random()*10, Math.random()*10,Math.random()*10);
        cubeEl.setAttribute('material','shader: flat; color:red');
      }, 800)
    });

    shipEl.addEventListener('collide', (e) => {
      gamestate.health = gamestate.health - 10;
      document.getElementById('health').setAttribute('value', 'Health: ' + gamestate.health);
    });

    cubeEl.addEventListener('collide', () => {
      cubeEl.body.velocity.set(0, 10,0);
    });

    arwingEl.addEventListener('collide', () => {
      arwingEl.body.velocity.set(0, 10,0);
    });

    arwingEl.addEventListener('click', () => {
      console.log('bam')
    });

    sceneEl.addEventListener('click', function() {
      document.getElementById('fire').play();
    });
  </script>
</html>